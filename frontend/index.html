<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReWear - Community Clothing Exchange</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <nav class="container">
            <a href="#" class="logo">ReWear</a>
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="#browse">Browse</a></li>
                <li><a href="#my-items">My Items</a></li>
                <li><a href="#exchanges">Exchanges</a></li>
                <li><a href="#community">Community</a></li>
            </ul>
            <div class="user-actions">
                <span class="points-display" id="pointsDisplay" style="display: none;">
                    <span class="points-icon">🌱</span>
                    <span id="userPoints">0</span> points
                </span>
                <a href="#" class="btn btn-secondary" id="loginBtn">Login</a>
                <a href="#" class="btn btn-primary" id="signupBtn">Sign Up</a>
                <a href="#" class="btn btn-secondary" id="logoutBtn" style="display: none;">Logout</a>
            </div>
        </nav>
    </header>

    <main>
        <div class="container">
            <!-- Hero Section -->
            <section class="hero" id="home">
                <h1>Sustainable Fashion Exchange</h1>
                <p>Give your clothes a second life and discover unique pieces from your community</p>
                
                <!-- Featured Items Carousel -->
                <div class="carousel-container">
                    <h3>Featured Items</h3>
                    <div class="carousel">
                        <div class="carousel-track" id="carouselTrack">
                            <!-- Carousel items will be populated by JavaScript -->
                        </div>
                        <button class="carousel-btn prev" id="prevBtn">‹</button>
                        <button class="carousel-btn next" id="nextBtn">›</button>
                    </div>
                </div>

                <div class="hero-actions">
                    <a href="#" class="btn btn-primary btn-large" id="startSwappingBtn">Start Swapping</a>
                    <a href="#browse" class="btn btn-secondary btn-large">Browse Items</a>
                    <a href="#" class="btn btn-accent btn-large" id="addItemBtn">List an Item</a>
                </div>
            </section>

            <!-- Main Content Tabs --
            <section class="main-content" id="browse">
                <div class="tab-buttons">
                    <button class="tab-button active" data-tab="browse">Browse Items</button>
                    <button class="tab-button" data-tab="my-items" id="myItemsTab" style="display: none;">My Items</button>
                    <button class="tab-button" data-tab="exchanges" id="exchangesTab" style="display: none;">My Exchanges</button>
                    <button class="tab-button" data-tab="profile" id="profileTab" style="display: none;">Profile</button>
                    <button class="tab-button" data-tab="admin" id="adminTab" style="display: none;">Admin Panel</button>
                </div>

                <!-- Browse Items Tab -->
                <div class="tab-content active" id="browse-content">
                    <div class="search-section">
                        <div class="search-bar">
                            <input type="text" class="search-input" placeholder="Search for clothing items..." id="searchInput">
                            <button class="btn btn-primary" id="searchBtn">Search</button>
                        </div>
                        <div class="filters">
                            <select class="filter-select" id="categoryFilter">
                                <option value="">All Categories</option>
                                <option value="tops">Tops</option>
                                <option value="bottoms">Bottoms</option>
                                <option value="dresses">Dresses</option>
                                <option value="outerwear">Outerwear</option>
                                <option value="shoes">Shoes</option>
                                <option value="accessories">Accessories</option>
                            </select>
                            <select class="filter-select" id="sizeFilter">
                                <option value="">All Sizes</option>
                                <option value="XS">XS</option>
                                <option value="S">S</option>
                                <option value="M">M</option>
                                <option value="L">L</option>
                                <option value="XL">XL</option>
                                <option value="XXL">XXL</option>
                            </select>
                            <select class="filter-select" id="conditionFilter">
                                <option value="">All Conditions</option>
                                <option value="new">New</option>
                                <option value="like-new">Like New</option>
                                <option value="good">Good</option>
                                <option value="fair">Fair</option>
                            </select>
                        </div>
                    </div>
                    <div class="items-grid" id="itemsGrid">
                        <!-- Items will be populated by JavaScript -->
                    </div>
                </div>

                <!-- My Items Tab -->
                <div class="tab-content" id="my-items-content">
                    <div class="section-header">
                        <h2>My Items</h2>
                        <button class="btn btn-primary" id="addItemBtn2">Add New Item</button>
                    </div>
                    <div class="items-grid" id="myItemsGrid">
                        <!-- User's items will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Exchanges Tab -->
                <div class="tab-content" id="exchanges-content">
                    <h2>My Exchange History</h2>
                    <div class="exchanges-container" id="exchangesContainer">
                        <!-- Exchange history will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Profile Tab -->
                <div class="tab-content" id="profile-content">
                    <div class="profile-section">
                        <div class="profile-header">
                            <div class="profile-avatar" id="profileAvatar">U</div>
                            <div class="profile-info">
                                <h2 id="profileName">User Name</h2>
                                <p id="profileLocation">Location</p>
                                <p id="profileMemberSince">Member since 2024</p>
                            </div>
                        </div>
                        <div class="profile-stats">
                            <div class="stat">
                                <div class="stat-number" id="itemsShared">0</div>
                                <div class="stat-label">Items Shared</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number" id="itemsReceived">0</div>
                                <div class="stat-label">Items Received</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number" id="communityRating">5.0</div>
                                <div class="stat-label">Community Rating</div>
                            </div>
                            <div class="stat">
                                <div class="stat-number" id="totalPoints">0</div>
                                <div class="stat-label">Total Points</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Panel Tab -->
                <div class="tab-content" id="admin-content">
                    <div class="admin-panel">
                        <h2>Admin Dashboard</h2>
                        <div class="admin-stats">
                            <div class="admin-card">
                                <h3>Total Users</h3>
                                <div class="admin-number">1,247</div>
                            </div>
                            <div class="admin-card">
                                <h3>Active Items</h3>
                                <div class="admin-number">3,891</div>
                            </div>
                            <div class="admin-card">
                                <h3>Completed Swaps</h3>
                                <div class="admin-number">2,156</div>
                            </div>
                            <div class="admin-card">
                                <h3>Pending Reports</h3>
                                <div class="admin-number">12</div>
                            </div>
                        </div>
                        <div class="admin-actions">
                            <button class="btn btn-primary">Manage Users</button>
                            <button class="btn btn-secondary">Review Reports</button>
                            <button class="btn btn-accent">System Settings</button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Add Item Modal -->
    <div class="modal" id="addItemModal">
        <div class="modal-content">
            <span class="close" id="closeAddModal">&times;</span>
            <h2>Add New Item</h2>
            <form id="addItemForm">
                <div class="form-group">
                    <label for="itemTitle">Item Title *</label>
                    <input type="text" id="itemTitle" name="title" required>
                    <div class="error-message" id="titleError"></div>
                </div>
                <div class="form-group">
                    <label for="itemDescription">Description *</label>
                    <textarea id="itemDescription" name="description" required placeholder="Describe your item in detail..."></textarea>
                    <div class="error-message" id="descriptionError"></div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="itemCategory">Category *</label>
                        <select id="itemCategory" name="category" required>
                            <option value="">Select Category</option>
                            <option value="tops">Tops</option>
                            <option value="bottoms">Bottoms</option>
                            <option value="dresses">Dresses</option>
                            <option value="outerwear">Outerwear</option>
                            <option value="shoes">Shoes</option>
                            <option value="accessories">Accessories</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="itemSize">Size *</label>
                        <select id="itemSize" name="size" required>
                            <option value="">Select Size</option>
                            <option value="XS">XS</option>
                            <option value="S">S</option>
                            <option value="M">M</option>
                            <option value="L">L</option>
                            <option value="XL">XL</option>
                            <option value="XXL">XXL</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="itemCondition">Condition *</label>
                    <select id="itemCondition" name="condition" required>
                        <option value="">Select Condition</option>
                        <option value="new">New with tags</option>
                        <option value="like-new">Like New</option>
                        <option value="good">Good</option>
                        <option value="fair">Fair</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="itemTags">Tags (comma separated)</label>
                    <input type="text" id="itemTags" name="tags" placeholder="vintage, casual, summer...">
                </div>
                <div class="form-group">
                    <label for="itemImage">Image Upload</label>
                    <div class="image-upload">
                        <input type="file" id="itemImage" name="image" accept="image/*">
                        <div class="upload-placeholder">
                            <span>📷</span>
                            <p>Click to upload image</p>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary btn-large">Add Item</button>
            </form>
        </div>
    </div>

    <!-- Item Details Modal -->
    <div class="modal" id="itemDetailsModal">
        <div class="modal-content modal-large">
            <span class="close" id="closeDetailsModal">&times;</span>
            <div id="itemDetailsContent">
                <!-- Item details will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <span class="close" id="closeLoginModal">&times;</span>
            <h2>Welcome Back</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email *</label>
                    <input type="email" id="loginEmail" name="email" required>
                    <div class="error-message" id="loginEmailError"></div>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password *</label>
                    <input type="password" id="loginPassword" name="password" required>
                    <div class="error-message" id="loginPasswordError"></div>
                </div>
                <button type="submit" class="btn btn-primary btn-large">Login</button>
                <p class="form-footer">Don't have an account? <a href="#" id="switchToSignup">Sign up here</a></p>
            </form>
        </div>
    </div>

    <!-- Signup Modal -->
    <div class="modal" id="signupModal">
        <div class="modal-content">
            <span class="close" id="closeSignupModal">&times;</span>
            <h2>Join ReWear</h2>
            <form id="signupForm">
                <div class="form-group">
                    <label for="signupName">Full Name *</label>
                    <input type="text" id="signupName" name="name" required>
                    <div class="error-message" id="signupNameError"></div>
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email *</label>
                    <input type="email" id="signupEmail" name="email" required>
                    <div class="error-message" id="signupEmailError"></div>
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password *</label>
                    <input type="password" id="signupPassword" name="password" required>
                    <div class="error-message" id="signupPasswordError"></div>
                </div>
                <div class="form-group">
                    <label for="signupLocation">Location *</label>
                    <input type="text" id="signupLocation" name="location" required>
                    <div class="error-message" id="signupLocationError"></div>
                </div>
                <button type="submit" class="btn btn-primary btn-large">Sign Up</button>
                <p class="form-footer">Already have an account? <a href="#" id="switchToLogin">Login here</a></p>
            </form>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <span id="notificationMessage"></span>
    </div>

    <script>
        // Sample data
        let items = [
            {
                id: 1,
                title: "Vintage Denim Jacket",
                description: "Classic blue denim jacket in excellent condition. Perfect for layering. This timeless piece has been well-maintained and shows minimal wear.",
                category: "outerwear",
                size: "M",
                condition: "good",
                image: "👕",
                owner: "Sarah M.",
                location: "Downtown",
                available: true,
                tags: ["vintage", "denim", "casual"],
                pointsValue: 25
            },
            {
                id: 2,
                title: "Floral Summer Dress",
                description: "Beautiful floral print dress, perfect for summer occasions. Lightweight fabric with a flattering fit.",
                category: "dresses",
                size: "S",
                condition: "like-new",
                image: "👗",
                owner: "Emma L.",
                location: "Midtown",
                available: true,
                tags: ["floral", "summer", "dress"],
                pointsValue: 30
            },
            {
                id: 3,
                title: "Black Leather Boots",
                description: "Stylish black leather boots with minor wear on the sole. Great for both casual and formal occasions.",
                category: "shoes",
                size: "L",
                condition: "good",
                image: "👢",
                owner: "Mike R.",
                location: "Uptown",
                available: true,
                tags: ["leather", "boots", "black"],
                pointsValue: 35
            },
            {
                id: 4,
                title: "Cozy Wool Sweater",
                description: "Warm and comfortable wool sweater in cream color. Perfect for chilly days.",
                category: "tops",
                size: "L",
                condition: "new",
                image: "🧥",
                owner: "Lisa K.",
                location: "Suburb",
                available: true,
                tags: ["wool", "cozy", "winter"],
                pointsValue: 40
            },
            {
                id: 5,
                title: "Designer Handbag",
                description: "Elegant designer handbag with minimal signs of use. Authentic leather with gold hardware.",
                category: "accessories",
                size: "M",
                condition: "like-new",
                image: "👜",
                owner: "Anna B.",
                location: "Downtown",
                available: true,
                tags: ["designer", "handbag", "luxury"],
                pointsValue: 50
            },
            {
                id: 6,
                title: "Casual Jeans",
                description: "Comfortable straight-leg jeans in dark wash. Classic fit that works with everything.",
                category: "bottoms",
                size: "M",
                condition: "good",
                image: "👖",
                owner: "Tom J.",
                location: "Midtown",
                available: true,
                tags: ["jeans", "casual", "denim"],
                pointsValue: 20
            }
        ];

        let currentUser = null;
        let userItems = [];
        let exchanges = [
            {
                id: 1,
                fromItem: { title: "Blue Sweater", image: "🧥" },
                toItem: { title: "Red Dress", image: "👗" },
                status: "completed",
                date: "2024-01-15",
                partner: "Alice Johnson"
            },
            {
                id: 2,
                fromItem: { title: "Black Boots", image: "👢" },
                toItem: { title: "White Sneakers", image: "👟" },
                status: "pending",
                date: "2024-01-20",
                partner: "Bob Smith"
            }
        ];

        let currentCarouselIndex = 0;

        // Initialize the app
        function init() {
            renderItems(items);
            renderCarousel();
            setupEventListeners();
            setupCarousel();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    switchTab(e.target.dataset.tab);
                });
            });

            // Search and filters
            document.getElementById('searchBtn').addEventListener('click', performSearch);
            document.getElementById('searchInput').addEventListener('input', performSearch);
            document.getElementById('categoryFilter').addEventListener('change', performSearch);
            document.getElementById('sizeFilter').addEventListener('change', performSearch);
            document.getElementById('conditionFilter').addEventListener('change', performSearch);

            // Modal controls
            document.getElementById('addItemBtn').addEventListener('click', openAddItemModal);
            document.getElementById('addItemBtn2').addEventListener('click', openAddItemModal);
            document.getElementById('startSwappingBtn').addEventListener('click', () => {
                if (currentUser) {
                    switchTab('browse');
                } else {
                    document.getElementById('loginModal').style.display = 'block';
                }
            });

            document.getElementById('loginBtn').addEventListener('click', () => {
                document.getElementById('loginModal').style.display = 'block';
            });

            document.getElementById('signupBtn').addEventListener('click', () => {
                document.getElementById('signupModal').style.display = 'block';
            });

            document.getElementById('logoutBtn').addEventListener('click', handleLogout);

            // Modal switching
            document.getElementById('switchToSignup').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('signupModal').style.display = 'block';
            });

            document.getElementById('switchToLogin').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('signupModal').style.display = 'none';
                document.getElementById('loginModal').style.display = 'block';
            });

            // Close modals
            document.querySelectorAll('.close').forEach(closeBtn => {
                closeBtn.addEventListener('click', (e) => {
                    e.target.closest('.modal').style.display = 'none';
                });
            });

            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });

            // Form submissions
            document.getElementById('addItemForm').addEventListener('submit', handleAddItem);
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('signupForm').addEventListener('submit', handleSignup);
        }

        // Carousel functionality
        function setupCarousel() {
            document.getElementById('prevBtn').addEventListener('click', () => {
                currentCarouselIndex = Math.max(0, currentCarouselIndex - 1);
                updateCarousel();
            });

            document.getElementById('nextBtn').addEventListener('click', () => {
                const maxIndex = Math.max(0, items.length - 3);
                currentCarouselIndex = Math.min(maxIndex, currentCarouselIndex + 1);
                updateCarousel();
            });
        }

        function renderCarousel() {
            const carouselTrack = document.getElementById('carouselTrack');
            carouselTrack.innerHTML = items.slice(0, 6).map(item => `
                <div class="carousel-item" onclick="showItemDetails(${item.id})">
                    <div class="carousel-image">${item.image}</div>
                    <div class="carousel-info">
                        <h4>${item.title}</h4>
                        <p>Size ${item.size} • ${item.condition}</p>
                    </div>
                </div>
            `).join('');
        }

        function updateCarousel() {
            const carouselTrack = document.getElementById('carouselTrack');
            const translateX = -currentCarouselIndex * 320;
            carouselTrack.style.transform = `translateX(${translateX}px)`;
        }

        // Switch between tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-content`).classList.add('active');

            switch(tabName) {
                case 'browse':
                    renderItems(items);
                    break;
                case 'my-items':
                    renderMyItems();
                    break;
                case 'exchanges':
                    renderExchanges();
                    break;
                case 'profile':
                    updateProfile();
                    break;
            }
        }

        // Render items
        function renderItems(itemsToRender) {
            const itemsGrid = document.getElementById('itemsGrid');
            if (itemsToRender.length === 0) {
                itemsGrid.innerHTML = '<div class="no-items">No items found matching your criteria.</div>';
                return;
            }

            itemsGrid.innerHTML = itemsToRender.map(item => `
                <div class="item-card" onclick="showItemDetails(${item.id})">
                    <div class="item-image">${item.image}</div>
                    <div class="item-info">
                        <div class="item-title">${item.title}</div>
                        <div class="item-description">${item.description.substring(0, 80)}...</div>
                        <div class="item-meta">
                            <span class="item-size">Size ${item.size}</span>
                            <span class="item-condition condition-${item.condition}">${item.condition}</span>
                        </div>
                        <div class="item-tags">
                            ${item.tags ? item.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : ''}
                        </div>
                        <div class="item-footer">
                            <span class="item-points">🌱 ${item.pointsValue} points</span>
                            <span class="item-location">📍 ${item.location}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Render user's items
        function renderMyItems() {
            const myItemsGrid = document.getElementById('myItemsGrid');
            if (!currentUser) {
                myItemsGrid.innerHTML = '<div class="no-items">Please login to view your items.</div>';
                return;
            }

            if (userItems.length === 0) {
                myItemsGrid.innerHTML = '<div class="no-items">You haven\'t added any items yet. <a href="#" onclick="openAddItemModal()">Add your first item!</a></div>';
                return;
            }

            myItemsGrid.innerHTML = userItems.map(item => `
                <div class="item-card my-item">
                    <div class="item-image">${item.image}</div>
                    <div class="item-info">
                        <div class="item-title">${item.title}</div>
                        <div class="item-description">${item.description.substring(0, 80)}...</div>
                        <div class="item-meta">
                            <span class="item-size">Size ${item.size}</span>
                            <span class="item-condition condition-${item.condition}">${item.condition}</span>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-small btn-secondary" onclick="editItem(${item.id})">Edit</button>
                            <button class="btn btn-small btn-danger" onclick="deleteItem(${item.id})">Delete</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Render exchanges
        function renderExchanges() {
            const exchangesContainer = document.getElementById('exchangesContainer');
            if (!currentUser) {
                exchangesContainer.innerHTML = '<div class="no-items">Please login to view your exchanges.</div>';
                return;
            }

            if (exchanges.length === 0) {
                exchangesContainer.innerHTML = '<div class="no-items">No exchanges yet. Start swapping to see your history here!</div>';
                return;
            }

            exchangesContainer.innerHTML = exchanges.map(exchange => `
                <div class="exchange-card">
                    <div class="exchange-header">
                        <h3>Exchange with ${exchange.partner}</h3>
                        <span class="exchange-status status-${exchange.status}">${exchange.status}</span>
                    </div>
                    <div class="exchange-items">
                        <div class="exchange-item">
                            <div class="item-image-small">${exchange.fromItem.image}</div>
                            <span>${exchange.fromItem.title}</span>
                        </div>
                        <div class="exchange-arrow">⇄</div>
                        <div class="exchange-item">
                            <div class="item-image-small">${exchange.toItem.image}</div>
                            <span>${exchange.toItem.title}</span>
                        </div>
                    </div>
                    <div class="exchange-date">Date: ${new Date(exchange.date).toLocaleDateString()}</div>
                </div>
            `).join('');
        }

        // Show item details
        function showItemDetails(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!item) return;

            const modal = document.getElementById('itemDetailsModal');
            const content = document.getElementById('itemDetailsContent');
            
            content.innerHTML = `
                <div class="item-details">
                    <div class="item-details-image">${item.image}</div>
                    <div class="item-details-info">
                        <h2>${item.title}</h2>
                        <p class="item-owner">Listed by ${item.owner} in ${item.location}</p>
                        <div class="item-details-meta">
                            <span class="detail-badge">Size ${item.size}</span>
                            <span class="detail-badge condition-${item.condition}">${item.condition}</span>
                            <span class="detail-badge points">🌱 ${item.pointsValue} points</span>
                        </div>
                        <div class="item-description-full">
                            <h3>Description</h3>
                            <p>${item.description}</p>
                        </div>
                        ${item.tags ? `
                            <div class="item-tags-full">
                                <h3>Tags</h3>
                                ${item.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                        <div class="item-actions-full">
                            ${currentUser ? `
                                <button class="btn btn-primary btn-large" onclick="requestSwap(${item.id})">Request Swap</button>
                                <button class="btn btn-accent btn-large" onclick="redeemWithPoints(${item.id})">Redeem with Points</button>
                            ` : `
                                <button class="btn btn-primary btn-large" onclick="showLoginPrompt()">Login to Swap</button>
                            `}
                        </div>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        // Search functionality
        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            const size = document.getElementById('sizeFilter').value;
            const condition = document.getElementById('conditionFilter').value;

            const filteredItems = items.filter(item => {
                const matchesSearch = item.title.toLowerCase().includes(searchTerm) || 
                                    item.description.toLowerCase().includes(searchTerm) ||
                                    (item.tags && item.tags.some(tag => tag.toLowerCase().includes(searchTerm)));
                const matchesCategory = !category || item.category === category;
                const matchesSize = !size || item.size === size;
                const matchesCondition = !condition || item.condition === condition;

                return matchesSearch && matchesCategory && matchesSize && matchesCondition;
            });

            renderItems(filteredItems);
        }

        // Form validation
        function validateForm(formData, formType) {
            const errors = {};

            if (formType === 'signup' || formType === 'addItem') {
                if (!formData.get('title') && formType === 'addItem') {
                    errors.title = 'Title is required';
                }
                if (!formData.get('name') && formType === 'signup') {
                    errors.name = 'Name is required';
                }
            }

            if (formType === 'signup' || formType === 'login') {
                const email = formData.get('email');
                if (!email) {
                    errors.email = 'Email is required';
                } else if (!/\S+@\S+\.\S+/.test(email)) {
                    errors.email = 'Please enter a valid email';
                }

                const password = formData.get('password');
                if (!password) {
                    errors.password = 'Password is required';
                } else if (password.length < 6 && formType === 'signup') {
                    errors.password = 'Password must be at least 6 characters';
                }
            }

            return errors;
        }

        function showFormErrors(errors, formType) {
            // Clear previous errors
            document.querySelectorAll('.error-message').forEach(el => el.textContent = '');

            // Show new errors
            Object.keys(errors).forEach(field => {
                const errorElement = document.getElementById(`${formType}${field.charAt(0).toUpperCase() + field.slice(1)}Error`) ||
                                  document.getElementById(`${field}Error`);
                if (errorElement) {
                    errorElement.textContent = errors[field];
                }
            });
        }

        // Handle form submissions
        function handleAddItem(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const errors = validateForm(formData, 'addItem');

            if (Object.keys(errors).length > 0) {
                showFormErrors(errors, '');
                return;
            }

            const newItem = {
                id: Date.now(),
                title: formData.get('title'),
                description: formData.get('description'),
                category: formData.get('category'),
                size: formData.get('size'),
                condition: formData.get('condition'),
                tags: formData.get('tags') ? formData.get('tags').split(',').map(tag => tag.trim()) : [],
                image: getRandomEmoji(formData.get('category')),
                owner: currentUser.name,
                location: currentUser.location,
                available: true,
                pointsValue: getPointsValue(formData.get('condition'))
            };

            userItems.push(newItem);
            items.push(newItem);
            
            document.getElementById('addItemModal').style.display = 'none';
            e.target.reset();
            showNotification('Item added successfully!');
            
            if (document.querySelector('[data-tab="my-items"]').classList.contains('active')) {
                renderMyItems();
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const errors = validateForm(formData, 'login');

            if (Object.keys(errors).length > 0) {
                showFormErrors(errors, 'login');
                return;
            }

            // Simulate login
            currentUser = {
                id: 1,
                name: 'John Doe',
                email: formData.get('email'),
                location: 'Downtown',
                points: 150,
                itemsShared: userItems.length,
                itemsReceived: exchanges.filter(e => e.status === 'completed').length,
                memberSince: '2024'
            };

            updateUIForLoggedInUser();
            document.getElementById('loginModal').style.display = 'none';
            e.target.reset();
            showNotification('Welcome back!');
        }

        function handleSignup(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const errors = validateForm(formData, 'signup');

            if (Object.keys(errors).length > 0) {
                showFormErrors(errors, 'signup');
                return;
            }

            // Simulate signup
            currentUser = {
                id: Date.now(),
                name: formData.get('name'),
                email: formData.get('email'),
                location: formData.get('location'),
                points: 50, // Welcome bonus
                itemsShared: 0,
                itemsReceived: 0,
                memberSince: '2024'
            };

            updateUIForLoggedInUser();
            document.getElementById('signupModal').style.display = 'none';
            e.target.reset();
            showNotification('Welcome to ReWear! You received 50 welcome points!');
        }

        function handleLogout() {
            currentUser = null;
            userItems = [];
            updateUIForLoggedOutUser();
            switchTab('browse');
            showNotification('Logged out successfully');
        }

        // UI updates
        function updateUIForLoggedInUser() {
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('signupBtn').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'inline-block';
            document.getElementById('pointsDisplay').style.display = 'flex';
            document.getElementById('userPoints').textContent = currentUser.points;

            // Show user tabs
            document.getElementById('myItemsTab').style.display = 'block';
            document.getElementById('exchangesTab').style.display = 'block';
            document.getElementById('profileTab').style.display = 'block';
            
            // Show admin tab for demo (in real app, check user role)
            if (currentUser.email === 'admin@rewear.com') {
                document.getElementById('adminTab').style.display = 'block';
            }

            updateProfile();
        }

        function updateUIForLoggedOutUser() {
            document.getElementById('loginBtn').style.display = 'inline-block';
            document.getElementById('signupBtn').style.display = 'inline-block';
            document.getElementById('logoutBtn').style.display = 'none';
            document.getElementById('pointsDisplay').style.display = 'none';

            // Hide user tabs
            document.getElementById('myItemsTab').style.display = 'none';
            document.getElementById('exchangesTab').style.display = 'none';
            document.getElementById('profileTab').style.display = 'none';
            document.getElementById('adminTab').style.display = 'none';
        }

        function updateProfile() {
            if (!currentUser) return;

            document.getElementById('profileName').textContent = currentUser.name;
            document.getElementById('profileLocation').textContent = currentUser.location;
            document.getElementById('profileMemberSince').textContent = `Member since ${currentUser.memberSince}`;
            document.getElementById('profileAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
            
            document.getElementById('itemsShared').textContent = userItems.length;
            document.getElementById('itemsReceived').textContent = exchanges.filter(e => e.status === 'completed').length;
            document.getElementById('communityRating').textContent = '4.8';
            document.getElementById('totalPoints').textContent = currentUser.points;
        }

        // Helper functions
        function openAddItemModal() {
            if (currentUser) {
                document.getElementById('addItemModal').style.display = 'block';
            } else {
                showNotification('Please login to add items');
                document.getElementById('loginModal').style.display = 'block';
            }
        }

        function showLoginPrompt() {
            document.getElementById('itemDetailsModal').style.display = 'none';
            document.getElementById('loginModal').style.display = 'block';
        }

        function requestSwap(itemId) {
            if (!currentUser) {
                showLoginPrompt();
                return;
            }
            showNotification('Swap request sent! The owner will be notified.');
            document.getElementById('itemDetailsModal').style.display = 'none';
        }

        function redeemWithPoints(itemId) {
            if (!currentUser) {
                showLoginPrompt();
                return;
            }
            const item = items.find(i => i.id === itemId);
            if (currentUser.points >= item.pointsValue) {
                currentUser.points -= item.pointsValue;
                document.getElementById('userPoints').textContent = currentUser.points;
                showNotification(`Item redeemed for ${item.pointsValue} points!`);
                document.getElementById('itemDetailsModal').style.display = 'none';
            } else {
                showNotification('Not enough points for this item.');
            }
        }

        function getRandomEmoji(category) {
            const emojis = {
                tops: ['👕', '👔', '🧥'],
                bottoms: ['👖', '🩳'],
                dresses: ['👗', '👘'],
                outerwear: ['🧥', '🧤'],
                shoes: ['👟', '👢', '👠', '🥿'],
                accessories: ['👜', '🎒', '👒', '🧣']
            };
            const categoryEmojis = emojis[category] || ['👕'];
            return categoryEmojis[Math.floor(Math.random() * categoryEmojis.length)];
        }

        function getPointsValue(condition) {
            const values = {
                'new': 50,
                'like-new': 40,
                'good': 30,
                'fair': 20
            };
            return values[condition] || 25;
        }

        function editItem(itemId) {
            showNotification('Edit functionality coming soon!');
        }

        function deleteItem(itemId) {
            if (confirm('Are you sure you want to delete this item?')) {
                userItems = userItems.filter(item => item.id !== itemId);
                items = items.filter(item => item.id !== itemId);
                renderMyItems();
                showNotification('Item deleted successfully');
            }
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            const messageElement = document.getElementById('notificationMessage');
            messageElement.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
